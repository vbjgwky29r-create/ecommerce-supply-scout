# 限流问题快速解决指南

## 问题
当前数据分析服务处于限流状态，无法获取实时数据。

## 快速解决方案

### 方案1：使用增强版工具（推荐）

智能体现在提供了带缓存和降级功能的增强版工具：

```python
# 原工具（容易触发限流）
web_search_tool(query="面膜")

# 增强版工具（自动缓存，自动降级）
web_search_tool_with_cache(query="面膜")
```

### 方案2：批量操作使用限流保护

```python
# 批量搜索，自动添加延迟，避免限流
batch_search_with_rate_limit(queries=["面膜", "护肤品", "彩妆"], delay=2.0)
```

### 方案3：查看服务状态

```python
# 查看当前各服务的可用性状态
get_service_status()
```

### 方案4：等待服务恢复

限流通常是临时的，系统会自动：
- 5分钟后重试不可用的服务
- 使用缓存数据提供服务
- 记录失败请求，服务恢复后重试

## 详细说明

### 缓存机制
- **搜索结果缓存30分钟**：相同查询不会重复请求
- **趋势数据缓存1小时**：趋势分析数据自动缓存
- **供应商数据缓存2小时**：减少数据库查询

### 降级服务
当服务不可用时，系统会：
1. 检查本地缓存数据
2. 返回历史搜索结果
3. 提示服务限流状态
4. 标记服务不可用5分钟

### 限流保护
- **每分钟最多30次请求**
- **每小时最多300次请求**
- 批量操作自动添加2秒延迟
- 超过限流自动等待

## 使用示例

### 示例1：搜索面膜供应商
```python
# 智能推荐方式（自动处理限流）
web_search_tool_with_cache(query="面膜供应商 1688", count=10)
```

### 示例2：批量搜索多个品类
```python
# 使用批量搜索，自动限流保护
queries = ["面膜", "护肤品", "彩妆", "香水"]
batch_search_with_rate_limit(queries=queries, delay=2.0)
```

### 示例3：获取市场趋势
```python
# 趋势数据会自动缓存，减少请求
trend_analysis_tool(category="面膜", time_range="1m")
```

## 配置调整

如需调整限流参数，编辑 `config/rate_limit_config.json`：

```json
{
  "rate_limit": {
    "max_calls_per_minute": 30,  // 每分钟最大调用次数
    "max_calls_per_hour": 300,   // 每小时最大调用次数
    "cooldown_time": 300         // 限流冷却时间（秒）
  }
}
```

## 常见问题

**Q: 为什么还是提示限流？**
A: 检查是否使用了正确的工具：
- 使用 `web_search_tool_with_cache` 替代 `web_search_tool`
- 使用 `batch_search_with_rate_limit` 进行批量操作

**Q: 缓存数据多久更新？**
A:
- 搜索结果：30分钟
- 趋势数据：1小时
- 供应商数据：2小时

**Q: 如何清空缓存？**
A: 系统会自动清理过期缓存，无需手动操作。

**Q: 降级数据准确吗？**
A: 降级数据来自服务正常时的查询结果，具有较高的参考价值。如需最新数据，请等待服务恢复。

## 技术支持

如遇持续问题，请：
1. 查看服务状态：`get_service_status()`
2. 查看详细文档：`docs/RATE_LIMIT_SOLUTIONS.md`
3. 联系技术支持团队

## 总结

✓ 使用增强版工具自动处理限流
✓ 批量操作使用限流保护
✓ 等待服务恢复（通常5分钟内）
✓ 信任缓存数据提供基本服务

**系统已为您准备好应对限流，继续使用即可！**
